---
- name: Bootstrap Ansible Automation Platform (AAP) with Projects, Inventory, and Job Templates
  hosts: localhost
  connection: local
  gather_facts: false

  collections:
    - ansible.controller

  vars:
    controller_host: ""
    controller_username: "admin"
    controller_password: "ansible123!"
    controller_validate_certs: false
    vault_addr: ""
    vault_namespace: "admin"
    vault_role_id: ""
    vault_secret_id: ""
    organization: "Default"

  tasks:
    - name: Create Vault AppRole credential (built-in HashiCorp Vault Secret Lookup)
      ansible.controller.credential:
        controller_host: "{{ controller_host }}"
        controller_username: "{{ controller_username }}"
        controller_password: "{{ controller_password }}"
        validate_certs: "{{ controller_validate_certs }}"
        name: "Vault AppRole Credential"
        description: "AppRole authentication for connecting AAP to Vault via env vars"
        organization: "{{ organization }}"
        credential_type: "HashiCorp Vault Secret Lookup"
        inputs:
          url: "{{ vault_addr }}"
          namespace: "{{ vault_namespace }}"
          default_auth_path: "approle"
          role_id: "{{ vault_role_id }}"
          secret_id: "{{ vault_secret_id }}"
          api_version: "v2"
        state: present
